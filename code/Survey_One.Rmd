---
title: "Marshall Fire Health Surevy One"
author: "Ryan Erickson"
date: "2023-04-05"
output: html_document
---

# Libraries
```{r, message=FALSE, warning=FALSE,error=FALSE}
library(dplyr)
library(tidyverse)
library(raster)
library(sf)
library(sp)
library(ggplot2)
library(gridExtra)
library(elevatr)
library(ggspatial)
library(ggmap) #citation("ggmap")
library(leaflet)
library(htmlwidgets)
library(kableExtra)
library(maps)
library(spdep)
library(ggsn)
library(car)
library(performance)
library(ggResidpanel)
library(ape)
library(reshape2)
library(ggpubr)
library(ggh4x)
```

# Function Junction
```{r}

tblFun <- function(x, l){
  tbl <- table(x)
  res <- cbind(tbl,round(prop.table(tbl)*100,2))
  colnames(res) <- c('Count','Percentage')
  knitr::kable(res, caption=l)
}

dist_func = function(df, aq) { 
  t=df %>%
    filter(impact_cat!="Complete loss") %>% 
    filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
    filter(!is.na(.[,aq])) %>% 
    group_by(group, .[,aq]) %>%
    summarise(n=n()) %>%
    mutate(aq.perc = n/sum(n)*100) %>%
    ungroup %>%
    mutate(total=sum(n), total.perc=n/total*100) #%>%
  #group_by(air_quality_1, impact_cat) #%>%
  #subset(select=c("impact_cat","air_quality_1","percent"),)
  #spread(impact_cat, percent)
  names(t)=c("group", "response", "count", "aq.perc", "total","total.perc")
  t
}

impact_func = function(df, aq) { 
  l=df %>%
    filter(impact_cat!="Complete loss") %>% 
    filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
    filter(!is.na(.[,aq])) %>% 
    group_by(impact_cat, .[,aq]) %>%
    summarise(n=n()) %>%
    mutate(aq.perc = n/sum(n)*100) %>%
    ungroup %>%
    mutate(total=sum(n), total.perc=n/total*100) #%>%
  #group_by(air_quality_1, impact_cat) #%>%
  #subset(select=c("impact_cat","air_quality_1","percent"),)
  #spread(impact_cat, percent)
  names(l)=c("group", "response", "count", "aq.perc", "total","total.perc")
  l
}

stack_plot = function(df, gp, vr, wv, type) {
  if(type==1){ti="Before the Fire"}
  if(type==2){ti="After the Fire"}
  if(type==3){ti="Wave One"}
  if(type==4){ti="Wave Two"}
  
  ggplot(df,aes(fill=response, x=aq.perc, y=group, width=.5)) +
    geom_bar(position="stack", stat="identity") +
    labs(title = paste0(ti, "\n N = ", df$total),
         subtitle = paste0("Area: ",vr,"\n Group By Cat: ",gp),
         y = paste0(wv),
         x = "Percent",
         fill ="") +
    scale_fill_manual(values = ryg.palette) +
    theme(plot.title = element_text(hjust = 0.5),
          plot.subtitle = element_text(hjust = 0.5))
}
```

# Data

```{r}
# Colors to Use
ryg.palette<-c("#DB4325", "#EDA247", "#E6E1BC","#57C4AD", "#006164")
ryg.palette.long<-c("#DB4325", "#EDA247", "#E6E1BC","#57C4AD", "#006164", "grey")
ryg.palette.short<-c("#EDA247", "#E6E1BC","#57C4AD", "#006164")

# API Key for Geocoding:
api_key = "AIzaSyAeoVaM_45SQ4G-lHeci1RhRNbhpxO3BDc"
register_google(key = api_key) 
waveone=read.csv("../data/marshall_w1_deID.csv")
wavetwo<-read.csv("../data/marshall_w2_deID.csv")
# waveone<-read.csv("/Volumes/research/Marshall Fire Health/marshall_w1_deID.csv")
# wavetwo<-read.csv("/Volumes/research/Marshall Fire Health/marshall_w2_deID.csv")
```

```{r}
wave.one<-waveone %>%
  mutate(mailingcity=recode_factor(mailingcity, "Superior"="SUPERIOR", "UNINCORPORATED"="BOULDER")) %>%
  mutate(across(air_quality_1:air_quality_4, as.factor)) %>%
  mutate(across(remediation_1:remediation_4, as.factor)) %>%
  mutate(across(air_cleaning_1:air_cleaning_4, as.factor)) %>%
  mutate(group=as.factor(group)) %>% 
  mutate(ownership_status=recode_factor(ownership_status,
                                        "1"="Owned",
                                        "2"="Rented",
                                        "3"="Owned but Not Living",
                                        "4"="Purchased after Dec. 30, 2021",
                                        "5"="Other")) %>%
  mutate(air_quality_1=recode_factor(air_quality_1,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_2=recode_factor(air_quality_2,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_3=recode_factor(air_quality_3,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_4=recode_factor(air_quality_4,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>% 
  mutate(home_smell_1week=recode_factor(home_smell_1week,
                                        "0"="No",
                                        "1"="Yes",
                                        "2"="Not sure/don't remember")) %>%
  mutate(home_smell_type=recode_factor(home_smell_type,
                                       "1"="Like a campfire",
                                       "2"="Like chemicals or a chemical fire",
                                       "3"="Other")) %>%
  mutate(group=recode_factor(group,
                             "A"="within fire perimeter",
                             "B"="within 1/2 mile",
                             "C"="1/2 to 1 mile",
                             "D"="1 to 2 miles")) %>%
  mutate(remediation_1=recode_factor(remediation_1, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_2=recode_factor(remediation_2, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_3=recode_factor(remediation_3, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_4=recode_factor(remediation_4, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(air_cleaning=recode_factor(air_cleaning_1, 
                                    "1"="Changing air filters in HVAC")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_2, 
                                    "1"="Using air cleaners"))%>%
  mutate(air_cleaning=recode_factor(air_cleaning_3, 
                                    "1"="Hiring someone to clean indoor air")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_4, 
                                    "1"="Other")) %>%
  mutate(air_cleaning_3=recode_factor(air_cleaning_3,
                                      "1"="Hiring someone to clean indoor air"))%>%
  mutate(air_cleaning_4=recode_factor(air_cleaning_4,
                                      "1"="Other")) %>%
  mutate(education=recode_factor(education,
                                 "0"="Did not specify", 
                                 "1"="High School Graduate",
                                 "2"="GED or Equivalent",
                                 "3"="Some College",
                                 "4"="Associate's Degree",
                                 "5"="Bachelor's Degree",
                                 "6"="Master's Degree",
                                 "7"="Doctoral Degree")) %>%
  mutate(income=recode_factor(income,
                              "1"="Less than $20,000", 
                              "2"="$20,000 to $34,999",
                              "3"="$35,000 to $49,999",
                              "4"="$50,000 to $79,999",
                              "5"="$80,000 to $99,999",
                              "6"="$100,000 to $149,999",
                              "7"="$150,000 to $199,999",
                              "8"="$200,000 or more",
                              "9"="Prefer not to answer")) %>%
  filter(finished==1) %>% #only analyzing finished data, not in wave.two
  filter(mailingcity=="BOULDER"|mailingcity=="SUPERIOR"|mailingcity=="LOUISVILLE") #filtering only respondents in Boulder Unincorporated, Superior or Louisville

wave.two<-wavetwo %>%
  mutate(air_quality_2=as.factor(air_quality_2)) %>%
  mutate(air_quality_4=as.factor(air_quality_4)) %>%
  mutate(across(remediation_1:remediation_4, as.factor)) %>%
  mutate(across(air_cleaning_1:air_cleaning_4, as.factor)) %>%
  mutate(group=as.factor(group)) %>% 
  mutate(renterowner=recode_factor(renterowner,
                                        "1"="Owned",
                                        "2"="Rented")) %>%
  mutate(air_quality_2=recode_factor(air_quality_2,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_4=recode_factor(air_quality_4,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(group=recode_factor(group,
                             "A"="within fire perimeter",
                             "B"="within 1/2 mile",
                             "C"="1/2 to 1 mile",
                             "D"="1 to 2 miles")) %>%
  mutate(remediation_1=recode_factor(remediation_1, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither")) %>%
  mutate(remediation_2=recode_factor(remediation_2, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither")) %>% 
  mutate(remediation_3=recode_factor(remediation_3, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither")) %>%
  mutate(remediation_4=recode_factor(remediation_4,
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_1, 
                                    "1"="Changing air filters in HVAC")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_2, 
                                    "1"="Using air cleaners")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_3, 
                                    "1"="Hiring someone to clean indoor air")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_4,
                                    "1"="Other")) %>%
  mutate(income=recode_factor(income,
                              "1"="Less than $20,000", 
                              "2"="$20,000 to $34,999",
                              "3"="$35,000 to $49,999",
                              "4"="$50,000 to $79,999",
                              "5"="$80,000 to $99,999",
                              "6"="$100,000 to $149,999",
                              "7"="$150,000 to $199,999",
                              "8"="$200,000 or more",
                              "9"="Prefer not to answer")) %>%
  mutate(education=recode_factor(education,
                                 "0"="Did not specify", 
                                 "1"="High School Graduate",
                                 "2"="GED or Equivalent",
                                 "3"="Some College",
                                 "4"="Associate's Degree",
                                 "5"="Bachelor's Degree",
                                 "6"="Master's Degree",
                                 "7"="Doctoral Degree"))
```

# Descriptive Survey Statistics (tables)

### Number of respondents for Wave 1 and Wave 2  
```{r}
wave.one.only2=filter(wave.one,wave.one$surveyid %in% wave.two$surveyid) #survey respondants in wave two who are not in wave one?
wave.two.only1=filter(wave.two,wave.two$surveyid %in% wave.one.only2$surveyid) #survey respondants in wave two who are not in wave 
# nrow(waveone)
# nrow(wavetwo)

Respondants = c(nrow(wave.one),nrow(wave.two), nrow(wave.one.only2))
Wave=c("One","Two","Both")
df1 = cbind(Wave,Respondants) %>%
  as.data.frame()
knitr::kable(df1, caption="Total Respondents")
# save_kable(knitr::kable(df1),"../images/w1w2_counts.png")
```

We utilized survey results of people whom completed the entire survey for accuracy. Wave one contained 3,462 total respondents with 802 of them completing the whole survey. Wave two had a total of 576 respondents who finished the survey. There were 568 respondents whom participated in both surveys, resulting in a 70.82% and 98.61% retention rate for wave one and wave two respectively. 

### % male/female 
```{r}
#### Wave One
tblFun(wave.one$Gender3, "Wave One - Gender")

#### Wave Two
tblFun(wave.two$Gender3, "Wave Two - Gender")
# table(wave.one.only2$Gender3, wave.two.only1$Gender3)
tblFun(wave.one.only2$Gender3, "Respondents in Both Waves - Gender")
chisq.test(wave.one.only2$Gender3, wave.two.only1$Gender3)
```

Both waves had a total of 350 (61.62%) people select female and 201 (35.39%) people select male, with 17 (3.91%) people selecting other or declining to state their gender. A majority of respondents were female, with 58.98% of the respondents selecting female in wave one compared to 60.94% in wave two, seeing a slight increase in female. Similarly, there was an increase of people in wave one (3.87%) than in wave two (4.17%) whom selected other or declined to state their gender. 37.16% of respondents selected male in wave one and 34.90% of them selected male in wave two. The \chi^2 test revealed that gender is a dependent variable and is statistically significant across both waves. 

### Educational attainment for each wave 
```{r}
#### Wave One
tblFun(wave.one$education, "Wave One - Education")

#### Wave Two
tblFun(wave.two$education, "Wave Two - Education")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$education, "Respondents in Both Waves - Education")
chisq.test(wave.one.only2$education, wave.two.only1$education)
```

We categorized the education levels of each respondent into seven categories: high school degree, GED or equivalent degree, some college education, associate’s degree, bachelor’s degree, masters’s degree, and doctoral degree. The most common degree for wave one was a bachelor's degree, with 39.34% of respondents having this level of education. For wave two, the most common level of education was a master's degree with 38.23%. The GED or equivalent category had the least amount of respondents in general. This was the same for respondents who responded to both waves, althought slightly less with 38.12% of respondents attaining a master's degree. The \chi^2 test revealed that education is a dependent variable and is statistically significant across both waves.

### Income for each wave 
```{r}
#### Wave One
tblFun(wave.one$income, "Wave One - Income")

#### Wave Two
tblFun(wave.two$income, "Wave Two - Income")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$income, "Respondents in Both Waves - Income")
chisq.test(wave.one.only2$income, wave.two.only1$income)
```

Income was categorized nine different bins: Less than \$20,000,	\$20,000 to \$34,999, \$35,000 to \$49,999, \$50,000 to \$79,999, \$80,000 to \$99,999, \$100,000 to \$149,999, \$150,000 to \$199,999, \$200,000 or more, and Prefer not to answer. The most income level for wave one was the \$200,000 or more range, with 39.34% of respondents making this much. This was the same for wave two as well as for respondents who responded to both waves, 26.60% and 26.32 respectively. The \chi^2 test also revealed that income is a dependent variable and statistically significant across both waves. 

### Race/ethnicity
```{r}
#### Wave One
tblFun(wave.one$RaceEthn2, "Wave One - Race/Ethnicity")

#### Wave Two
tblFun(wave.two$RaceEthn2, "Wave Two - Race/Ethnicity")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$RaceEthn2, "Respondents in Both Waves - Race/Ethnicity")
chisq.test(wave.one.only2$RaceEthn2, wave.two.only1$RaceEthn2)
```

For ease of comparison amongst the two groups, we only categorized race and ethnicity into two different categories, white and person of color (POC). A majority of people in wave one, wave two, and of respondents who completed both waves were white, being 86.16%, 88.02%, and 89.09 respectively. The \chi^2 test showed that income is a dependent variable and is statistically significant across both waves. 

### Owner/Renter
```{r}
#### Wave One
tblFun(wave.one$ownership_status, "Wave One - Ownership Status")

#### Wave Two
tblFun(wave.two$renterowner, "Wave Two - Ownership Status")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$ownership_status, "Respondents in Both Waves - Ownership Status")
chisq.test(wave.one.only2$ownership_status, wave.two.only1$renterowner)
```

Wave one and wave two had different categories of ownership. Wave one was categorized into Owned, Rented, Owned but Not Living, Purchased after Dec. 30, 2021, and Other. Wave two was only categorized into Owned and Rented. A majority of people in wave one, wave two, and of respondents who completed both waves owned their homes during the Marshal Fire, with 93.12%, 96.18%, and 94.01% respectively. The \chi^2 test revealed that ownership status is a dependent variable and is statistically significant across both waves
 
### Impact category 
```{r}
#### Wave One
tblFun(filter(wave.one,wave.one$impact_cat!="")$impact_cat, "Wave One - Impact Category")

#### Wave Two
tblFun(wave.two$impact_cat, "Wave Two - Impact Category")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$impact_cat, "Respondents in Both  - Impact Category")
chisq.test(wave.one.only2$impact_cat, wave.two.only1$impact_cat)
```

Each participant recorded the amount of damage to their property and whether or not they lived at the current address. These were combined to create the impact category, which was seperated into 5 levels; Complete loss; Damaged, living there; Damaged, not living there; No damage, living there; No damage, not living there. Most respondents in wave one, wave two, and of respondents who completed both waves were living at thier current address while sustaining damage to the property from the Marshal Fire, with 44.65%, 43.23%, and 43.13% respectively. The \chi^2 test revealed that these impact categories are both dependent variable and statistically significant across both waves.

### Distance category
```{r} 
#### Wave One
tblFun(wave.one$group, "Wave One - Distance Category")

#### Wave Two
tblFun(wave.two$group, "Wave Two - Distance Category")
# table(wave.one.only2$education, wave.two.only1$education)
tblFun(wave.one.only2$group, "Respondents in Both Waves - Distance Category")
chisq.test(wave.one.only2$group, wave.two.only1$group)
```

The proximity of each participant's property to the Marshall fire was split into four categories, within the fire perimeter within a 1/2 mile of the fire, within 1/2 to 1 mile of the fire, and within 1 to 2 miles of the fire. Most respondents in wave one, wave two, and of respondents who completed both waves were within the fire perimeter with 57.96%, 59.55%, and 59.33% respectively. The \chi^2 test revealed that income is also a dependent variable and is statistically significant across both waves.

# Air Quality Perceptions

## Wave One:

### Wave One only: compare before and after the fire – perception of air quality in their neighborhood 
```{r}
special=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_1"])) %>% 
  group_by(.["air_quality_1"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Before the fire: \n N = ",sum(n)))
special2=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("After the fire: \n N = ",sum(n)))
names(special)=c("response", "count", "aq.perc", "t")
names(special2)=c("response", "count", "aq.perc","t")

special.df=rbind(special,special2) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("I am confident that the air in my neighborhood is safe to breathe"),
       subtitle = paste0("Need to fix labels still"),
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())
#+ geom_text(aes(y = desc(lab)+100, label = round(aq.perc)))

special3=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_1"])) %>% 
  group_by(.["air_quality_1"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Before the fire: \n N = ",sum(n)))
special4=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("After the fire: \n N = ",sum(n)))
names(special3)=c("response", "count", "aq.perc", "t")
names(special4)=c("response", "count", "aq.perc","t")

special.df2=rbind(special3,special4) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df2, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("I am confident that the air in my neighborhood is safe to breathe \n Respondents in Both Waves"),
       subtitle = paste0("Need to fix labels still"),
       caption = "There seems to be different numbers of complete \n loss and those that left impact category unanswered",
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())
#+ geom_text(aes(y = desc(lab)+100, label = round(aq.perc)))
chisq.test(wave.one.only2$air_quality_1, wave.one.only2$air_quality_2)

# #trying a vertical graph
# w1.before.neigh.plot=ggplot(filter(wave.one,!is.na(air_quality_1)), aes(fill=air_quality_1,x="Before the Fire",y=)) +
#   geom_bar(position="stack") +
#   labs(title = NULL) +
#   xlab(NULL) +
#   ylab("Count") +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# w1.after.neigh.plot=ggplot(filter(wave.one,!is.na(air_quality_3)), aes(fill=air_quality_3,x="After the Fire")) +
#   geom_bar(position="stack") +
#   xlab(NULL) +
#   ylab(NULL) +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# ggarrange(w1.before.neigh.plot,w1.after.neigh.plot, ncol=2, common.legend = T, align = "v")
```

Survey participates were asked how safe they felt breathing the air in their neighborhood both before and after the fire. Of the participants who participated in both waves of questionnaires, it seems there was only one person who did not populate this field after the Marshall fire. In addition, slightly more people strongly disagreed that the air was safe to breath, although more people seemed to strongly agree with this statement as well. There were about the same amount of resppondents that neither agreed nor disagreed with the statement. Perceptions of air quality before and after the Marshall fire are dependent on each other, and from the $\chi$^2 test we can deduce that these variables are statistically significant to each other in this study. 

### Wave One only: compare before and after the fire – perception of air quality in their neighborhood by distance 

```{r}
# t99=ggplot(filter(wave.one,!is.na(air_quality_1)), aes(fill=air_quality_1, y=group)) +
#     geom_bar(position="stack") +
#   labs(title = "Before the Marshall Fire, I was confident that the air in my neighborhood was \n safe to breathe",
#        y = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# t991=ggplot(filter(wave.one,!is.na(air_quality_3)), aes(fill=air_quality_3, y=group)) +
#     geom_bar(position="stack") +
#   labs(title = "Currently, I am confident that the air in my neighborhood is \n safe to breathe",
#        y = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# ggarrange(t99,t991, ncol=2, common.legend = T)

AQ_1.w1.dist=dist_func(wave.one,"air_quality_1")
AQ_2.w1.dist=dist_func(wave.one,"air_quality_2")

AQ_1.w1.dist.plot=stack_plot(AQ_1.w1.dist,"Distance","Neighborhood","Proximity",1)
AQ_2.w1.dist.plot=stack_plot(AQ_2.w1.dist,"Distance","Neighborhood","Proximity",2)

annotate_figure(ggarrange(AQ_1.w1.dist.plot,AQ_2.w1.dist.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath")

AQ_1.w1f.dist=dist_func(wave.one.only2,"air_quality_1")
AQ_2.w1f.dist=dist_func(wave.one.only2,"air_quality_2")

AQ_1.w1f.dist.plot=stack_plot(AQ_1.w1f.dist,"Distance","Neighborhood","Proximity",1)
AQ_2.w1f.dist.plot=stack_plot(AQ_2.w1f.dist,"Distance","Neighborhood","Proximity",2)

annotate_figure(ggarrange(AQ_1.w1f.dist.plot,AQ_2.w1f.dist.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath \n Respondents in Both Waves")
```

### Wave One only: compare before and after the fire – perception of air quality in their neighborhood by impact category 

```{r}
# ggplot(filter(wave.one,!is.na(air_quality_1)), aes(fill=air_quality_1, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Before the Marshall Fire, I was confident that the air in my neighborhood was \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# ggplot(filter(wave.one,!is.na(air_quality_3)), aes(fill=air_quality_3, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Currently, I am confident that the air in my neighborhood is \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)

AQ_1.w1.impact=impact_func(wave.one,"air_quality_1")
AQ_2.w1.impact=impact_func(wave.one,"air_quality_2")

AQ_1.w1.impact.plot=stack_plot(AQ_1.w1.impact,"Impact Category","Neighborhood","",1)
AQ_2.w1.impact.plot=stack_plot(AQ_2.w1.impact,"Impact Category","Neighborhood","",2)

annotate_figure(ggarrange(AQ_1.w1.impact.plot,AQ_2.w1.impact.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath")

AQ_1.w1f.impact=impact_func(wave.one.only2,"air_quality_1")
AQ_2.w1f.impact=impact_func(wave.one.only2,"air_quality_2")

AQ_1.w1f.impact.plot=stack_plot(AQ_1.w1f.impact,"Impact Category","Neighborhood","",1)
AQ_2.w1f.impact.plot=stack_plot(AQ_2.w1f.impact,"Impact Category","Neighborhood","",2)

annotate_figure(ggarrange(AQ_1.w1f.impact.plot,AQ_2.w1f.impact.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath \n Respondents in Both Waves")
```

### Wave One only: compare before and after the fire – perception of air quality in their home 

```{r}
# #trying a horizontal graph
# w1.before.home.plot=ggplot(filter(wave.one,!is.na(air_quality_2)), aes(fill=air_quality_2,y="Before the Fire")) +
#   geom_bar(position="stack") +
#   labs(title = "I am confident that the air inside my home is safe to breathe") +
#   ylab(NULL) +
#   xlab(NULL) +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# w1.after.home.plot=ggplot(filter(wave.one,!is.na(air_quality_4)), aes(fill=air_quality_4,y="After the Fire")) +
#   geom_bar(position="stack") +
#   ylab(NULL) +
#   xlab("Count") +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# grid.arrange(w1.before.home.plot,w1.after.home.plot)

special5=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_3"])) %>% 
  group_by(.["air_quality_3"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Before the fire: \n N = ",sum(n)))
special6=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("After the fire: \n N = ",sum(n)))
names(special5)=c("response", "count", "aq.perc", "t")
names(special6)=c("response", "count", "aq.perc","t")

special.df3=rbind(special5,special6) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df3, aes(x = t, y = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("I am confident that the air in my neighborhood is safe to breathe"),
       subtitle = paste0("Need to fix labels still"),
       y = paste0("Percent"), 
       x = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())
#+ geom_text(aes(y = desc(lab)+100, label = round(aq.perc)))

special7=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_3"])) %>% 
  group_by(.["air_quality_3"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Before the fire: \n N = ",sum(n)))
special8=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("After the fire: \n N = ",sum(n)))
names(special7)=c("response", "count", "aq.perc", "t")
names(special8)=c("response", "count", "aq.perc","t")

special.df4=rbind(special7,special8) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df4, aes(x = t, y = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("I am confident that the air in my neighborhood is safe to breathe \n Respondents in Both Waves"),
       subtitle = paste0("Need to fix labels still"),
       caption = "There seems to be different numbers of complete \n loss and those that left impact category unanswered",
       y = paste0("Percent"), 
       x = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())
#+ geom_text(aes(y = desc(lab)+100, label = round(aq.perc)))
chisq.test(wave.one.only2$air_quality_3, wave.one.only2$air_quality_4)
```

### Wave One only: compare before and after the fire – perception of air quality in their home by distance 

```{r}
AQ_3.w1.dist=dist_func(wave.one,"air_quality_3")
AQ_4.w1.dist=dist_func(wave.one,"air_quality_4")

AQ_3.w1.dist.plot=stack_plot(AQ_1.w1.dist,"Distance","Home","Proximity",1)
AQ_4.w1.dist.plot=stack_plot(AQ_2.w1.dist,"Distance","Home","Proximity",2)

annotate_figure(ggarrange(AQ_3.w1.dist.plot,AQ_4.w1.dist.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air inside my home is safe to breath")

AQ_3.w1f.dist=dist_func(wave.one.only2,"air_quality_3")
AQ_4.w1f.dist=dist_func(wave.one.only2,"air_quality_4")

AQ_3.w1f.dist.plot=stack_plot(AQ_1.w1f.dist,"Distance","Home","Proximity",1)
AQ_4.w1f.dist.plot=stack_plot(AQ_2.w1f.dist,"Distance","Home","Proximity",2)

annotate_figure(ggarrange(AQ_3.w1f.dist.plot,AQ_4.w1f.dist.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air inside my home is safe to breath \n Respondents in Both Waves")
```

### Wave One only: compare before and after the fire – perception of air quality in their home by impact category

```{r}
# ggplot(filter(wave.one,!is.na(air_quality_2)), aes(fill=air_quality_2, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Before the Marshall Fire, I was confident that the air in my neighborhood was \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# ggplot(filter(wave.one,!is.na(air_quality_4)), aes(fill=air_quality_4, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Currently, I am confident that the air in my neighborhood is \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
AQ_3.w1.impact=impact_func(wave.one,"air_quality_3")
AQ_4.w1.impact=impact_func(wave.one,"air_quality_4")

AQ_3.w1.impact.plot=stack_plot(AQ_3.w1.impact,"Impact Category","Neighborhood","",1)
AQ_4.w1.impact.plot=stack_plot(AQ_4.w1.impact,"Impact Category","Neighborhood","",2)

annotate_figure(ggarrange(AQ_3.w1.impact.plot,AQ_4.w1.impact.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath")

AQ_3.w1f.impact=impact_func(wave.one.only2,"air_quality_3")
AQ_4.w1f.impact=impact_func(wave.one.only2,"air_quality_4")

AQ_3.w1f.impact.plot=stack_plot(AQ_3.w1f.impact,"Impact Category","Neighborhood","",1)
AQ_4.w1f.impact.plot=stack_plot(AQ_4.w1f.impact,"Impact Category","Neighborhood","",2)

annotate_figure(ggarrange(AQ_3.w1f.impact.plot,AQ_4.w1f.impact.plot, legend = "top", common.legend = T, nrow=2), top = "Wave One \n I am confident that the air in my neighborhood is safe to breath \n Respondents in Both Waves")
```

## Wave One and Two:

### Wave One to Wave Two comparison – perception of air quality in neighborhood (AQ2) 

```{r}
# w1.after.neigh.plot=ggplot(filter(wave.one,!is.na(air_quality_2)), aes(fill=air_quality_2,y="Wave One")) +
#   geom_bar(position="stack") +
#   labs(title = "I am confident that the air in my neighborhood is safe to breathe") +
#   ylab(NULL) +
#   xlab(NULL) +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# w2.after.neigh.plot=ggplot(filter(wave.two,!is.na(air_quality_2)), aes(fill=air_quality_2,y="Wave Two")) +
#   geom_bar(position="stack") +
#   ylab(NULL) +
#   xlab("Count") +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# grid.arrange(w1.after.neigh.plot,w2.after.neigh.plot)
special.w1=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave One: \n N = ",sum(n)))
names(special.w1)=c("response", "count", "aq.perc","t")

special.w2=wave.two %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave Two: \n N = ",sum(n)))
names(special.w2)=c("response", "count", "aq.perc", "t")
special.df=rbind(special.w1,special.w2) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("Currently, I am confident that the \n air in my neighborhood is safe to breathe"),
       subtitle = paste0("Need to fix labels still"),
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())

special.w1f=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave One: \n N = ",sum(n)))
names(special.w1f)=c("response", "count", "aq.perc","t")
special.w2f=wave.two.only1 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_2"])) %>% 
  group_by(.["air_quality_2"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave Two: \n N = ",sum(n)))
names(special.w2f)=c("response", "count", "aq.perc", "t")
special.df=rbind(special.w1f,special.w2f) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("Currently, I am confident that the \n air in my neighborhood is safe to breathe"),
       subtitle = paste0("Respondents in Both Waves \n Need to fix labels still"),
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())

chisq.test(wave.one.only2$air_quality_2, wave.two.only1$air_quality_2)
```

### Wave One to Wave Two comparison – perception of air quality in neighborhood (AQ2) by distance 

```{r}
# w1.after.neigh.plot=ggplot(filter(wave.one,!is.na(air_quality_2)), aes(fill=air_quality_2,y="Wave One")) +
#   geom_bar(position="stack") +
#   labs(title = "I am confident that the air in my neighborhood is safe to breathe") +
#   ylab(NULL) +
#   xlab(NULL) +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# w2.after.neigh.plot=ggplot(filter(wave.two,!is.na(air_quality_2)), aes(fill=air_quality_2,y="Wave Two")) +
#   geom_bar(position="stack") +
#   ylab(NULL) +
#   xlab("Count") +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# grid.arrange(w1.after.neigh.plot,w2.after.neigh.plot)

AQ_2.w2.dist=dist_func(wave.two,"air_quality_2")
AQ_2.w2f.dist=dist_func(wave.two.only1,"air_quality_2")

AQ_2.w1.dist.plot2=stack_plot(AQ_2.w1.dist,"Distance","Neighborhood","Proximity",3)
AQ_2.w1f.dist.plot2=stack_plot(AQ_2.w1f.dist,"Distance","Neighborhood","Proximity",3)

AQ_2.w2.dist.plot=stack_plot(AQ_2.w2.dist,"Distance","Neighborhood","Proximity",4)
AQ_2.w2f.dist.plot=stack_plot(AQ_2.w2f.dist,"Distance","Neighborhood","Proximity",4)


annotate_figure(ggarrange(AQ_2.w1.dist.plot2,AQ_2.w2.dist.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath")
annotate_figure(ggarrange(AQ_2.w1f.dist.plot2,AQ_2.w2f.dist.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath\n Respondents in Both Waves")
```

### Wave One to Wave Two comparison – perception of air quality in neighborhood (AQ2) by impact category 

```{r}
# ggplot(filter(wave.one,!is.na(air_quality_2)), aes(fill=air_quality_2, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Before the Marshall Fire, I was confident that the air in my neighborhood was \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# ggplot(filter(wave.two,!is.na(air_quality_2)), aes(fill=air_quality_2, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "Before the Marshall Fire, I was confident that the air in my neighborhood was \n safe to breathe",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)

AQ_2.w2.impact=impact_func(wave.two,"air_quality_2")
AQ_2.w2f.impact=impact_func(wave.two.only1,"air_quality_2")

AQ_2.w1.impact.plot2=stack_plot(AQ_2.w1.impact,"Impact Category","Neighborhood","",3)
AQ_2.w1f.impact.plot2=stack_plot(AQ_2.w1f.impact,"Impact Category","Neighborhood","",3)

AQ_2.w2.impact.plot=stack_plot(AQ_2.w2.impact,"Impact Category","Neighborhood","",4)
AQ_2.w2f.impact.plot=stack_plot(AQ_2.w2f.impact,"Impact Category","Neighborhood","",4)


annotate_figure(ggarrange(AQ_2.w1.impact.plot2,AQ_2.w2.impact.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath")
annotate_figure(ggarrange(AQ_2.w1f.impact.plot2,AQ_2.w2f.impact.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath\n Respondents in Both Waves")
```

### Wave One to Wave Two comparison – perception of air quality in home (AQ4) 

```{r}
# w1.after.home.plot=ggplot(filter(wave.one,!is.na(air_quality_4)), aes(fill=air_quality_4,y="Wave One")) +
#   geom_bar(position="stack") +
#   labs(title = "I am confident that the air in my neighborhood is safe to breathe") +
#   ylab(NULL) +
#   xlab(NULL) +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# w2.after.home.plot=ggplot(filter(wave.two,!is.na(air_quality_4)), aes(fill=air_quality_4,y="Wave Two")) +
#   geom_bar(position="stack") +
#   ylab(NULL) +
#   xlab("Count") +
#   scale_fill_manual(values = ryg.palette) +
#   theme(plot.title = element_text(hjust = 0.5),   
#         plot.subtitle = element_text(hjust = 0.5)) +
#   guides(fill=guide_legend(title=NULL))
# 
# grid.arrange(w1.after.neigh.plot,w2.after.neigh.plot)
special.w1.v2=wave.one %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave One: \n N = ",sum(n)))
names(special.w1.v2)=c("response", "count", "aq.perc","t")

special.w2.v2=wave.two %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave Two: \n N = ",sum(n)))
names(special.w2.v2)=c("response", "count", "aq.perc", "t")
special.df3=rbind(special.w1.v2,special.w2.v2) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df3, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("Currently, I am confident that the \n air inside my home is safe to breathe"),
       subtitle = paste0("Need to fix labels still"),
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())

special.w1.v2f=wave.one.only2 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave One: \n N = ",sum(n)))
names(special.w1.v2f)=c("response", "count", "aq.perc","t")
special.w2.v2f=wave.two.only1 %>%
  filter(impact_cat!="Complete loss") %>% 
  filter(!is.na(group)) %>% #removing all in complete loss because they were not given these questions to answer
  filter(!is.na(.[,"air_quality_4"])) %>% 
  group_by(.["air_quality_4"]) %>%
  summarise(n=n()) %>%
  ungroup() %>%   
  mutate(aq.perc = n/sum(n)*100,
         t=paste0("Wave Two: \n N = ",sum(n)))
names(special.w2.v2f)=c("response", "count", "aq.perc", "t")
special.df4=rbind(special.w1.v2f,special.w2.v2f) %>% 
  group_by(t) %>% 
  mutate(lab=cumsum(aq.perc))

ggplot(special.df4, aes(y = t, x = aq.perc, fill = response)) +
  geom_col() +
  labs(title = paste0("Currently, I am confident that the \n air inside my home is safe to breathe"),
       subtitle = paste0("Respondents in Both Waves \n Need to fix labels still"),
       x = paste0("Percent"), 
       y = "", 
       fill ="") +
  scale_fill_manual(values = ryg.palette) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text())
chisq.test(wave.one.only2$air_quality_4, wave.two.only1$air_quality_4)
```

### Wave One to Wave Two comparison – perception of air quality in home (AQ4) by distance 

```{r}
# ggplot(filter(wave.one,!is.na(air_quality_4)), aes(fill=air_quality_4, x=group)) +
#     geom_bar(position="stack") +
#   labs(title = "I am confident that the air inside my home was \n safe to breathe",
#        subtitle = "Wave One",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# ggplot(filter(wave.two,!is.na(air_quality_4)), aes(fill=air_quality_4, x=group)) +
#     geom_bar(position="stack") +
#   labs(title = "I am confident that the air inside my home was \n safe to breathe",
#        subtitle = "Wave Two",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)

AQ_4.w2.dist=dist_func(wave.two,"air_quality_4")
AQ_4.w2f.dist=dist_func(wave.two.only1,"air_quality_4")

AQ_4.w1.dist.plot2=stack_plot(AQ_4.w1.dist,"Distance","Neighborhood","Proximity",3)
AQ_4.w1f.dist.plot2=stack_plot(AQ_4.w1f.dist,"Distance","Neighborhood","Proximity",3)

AQ_4.w2.dist.plot=stack_plot(AQ_4.w2.dist,"Distance","Neighborhood","Proximity",4)
AQ_4.w2f.dist.plot=stack_plot(AQ_4.w2f.dist,"Distance","Neighborhood","Proximity",4)


annotate_figure(ggarrange(AQ_4.w1.dist.plot2,AQ_4.w2.dist.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air inside my home is safe to breath")
annotate_figure(ggarrange(AQ_4.w1f.dist.plot2,AQ_4.w2f.dist.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air inside my home is safe to breath\n Respondents in Both Waves")
```

### Wave One to Wave Two comparison – perception of air quality in home (AQ4) by impact category 

```{r}
# ggplot(filter(wave.one,!is.na(air_quality_4)), aes(fill=air_quality_4, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "I am confident that the air inside my home was \n safe to breathe",
#        subtitle = "Wave One",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)
# 
# ggplot(filter(wave.two,!is.na(air_quality_4)), aes(fill=air_quality_4, x=impact_cat)) +
#     geom_bar(position="stack") +
#   labs(title = "I am confident that the air inside my home was \n safe to breathe",
#        subtitle = "Wave Two",
#        x = "Distance from fire perimeter", fill ="") +
#    scale_fill_manual(values = ryg.palette)

AQ_4.w2.impact=impact_func(wave.two,"air_quality_4")
AQ_4.w2f.impact=impact_func(wave.two.only1,"air_quality_4")

AQ_4.w1.impact.plot2=stack_plot(AQ_2.w1.impact,"Impact Category","Neighborhood","",3)
AQ_4.w1f.impact.plot2=stack_plot(AQ_2.w1f.impact,"Impact Category","Neighborhood","",3)

AQ_4.w2.impact.plot=stack_plot(AQ_2.w2.impact,"Impact Category","Neighborhood","",4)
AQ_4.w2f.impact.plot=stack_plot(AQ_2.w2f.impact,"Impact Category","Neighborhood","",4)


annotate_figure(ggarrange(AQ_4.w1.impact.plot2,AQ_4.w2.impact.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath")
annotate_figure(ggarrange(AQ_4.w1f.impact.plot2,AQ_4.w2f.impact.plot, legend = "right", common.legend = T, nrow=2), top = "Waves One and Two\n I am confident that the air in my neighborhood is safe to breath\n Respondents in Both Waves")
```


# Maps:
#### Data for Maps Section:
```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
mapwave1=read.csv("/Volumes/research/Marshall Fire Health/marshall_w1.csv")

# fixes:
mapwave1[mapwave1$mailingaddr1=="553 GRANT ST",]$mailingaddr1 = "553 GRANT AVE"

#geocoding - assigning lats and longs via Google API - will need key
# ~5 errors
geo_marshall=mapwave1%>% #geocoding only completed surveys and those with lat and long
  mutate(mailingcity=recode_factor(mailingcity, 'Superior'='SUPERIOR', 'UNINCORPORATED'='BOULDER')) %>%
  mutate(across(air_quality_1:air_quality_4, as.factor)) %>%
  mutate(across(remediation_1:remediation_4, as.factor)) %>%
  mutate(across(air_cleaning_1:air_cleaning_4, as.factor)) %>%
  mutate(group=as.factor(group)) %>% 
  mutate(ownership_status=recode_factor(ownership_status,
                                        "1"="Owned",
                                        "2"="Rented",
                                        "3"="Owned but Not Living",
                                        "4"="Purchased after Dec. 30, 2021",
                                        "5"="Other")) %>%
  mutate(air_quality_1=recode_factor(air_quality_1,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_2=recode_factor(air_quality_2,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_3=recode_factor(air_quality_3,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>%
  mutate(air_quality_4=recode_factor(air_quality_4,
                                     "1"="Strongly disagree",
                                     "2"="Somewhat disagree",
                                     "3"="Neither agree nor disagree",
                                     "4"="Somewhat agree",
                                     "5"="Strongly agree",
                                     "6"="Don't know")) %>% 
  mutate(home_smell_1week=recode_factor(home_smell_1week,
                                        "0"="No",
                                        "1"="Yes",
                                        "2"="Not sure/don't remember")) %>%
  mutate(home_smell_type=recode_factor(home_smell_type,
                                       "1"="Like a campfire",
                                       "2"="Like chemicals or a chemical fire",
                                       "3"="Other")) %>%
  mutate(group=recode_factor(group,
                             "A"="within fire perimeter",
                             "B"="within 1/2 mile",
                             "C"="1/2 to 1 mile",
                             "D"="1 to 2 miles")) %>%
  mutate(remediation_1=recode_factor(remediation_1, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_2=recode_factor(remediation_2, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_3=recode_factor(remediation_3, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(remediation_4=recode_factor(remediation_4, 
                                     "1"="Did this already",
                                     "2"="Plan to do this",
                                     "3"="Neither"))%>%
  mutate(air_cleaning=recode_factor(air_cleaning_1, 
                                    "1"="Changing air filters in HVAC")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_2, 
                                    "1"="Using air cleaners"))%>%
  mutate(air_cleaning=recode_factor(air_cleaning_3, 
                                    "1"="Hiring someone to clean indoor air")) %>%
  mutate(air_cleaning=recode_factor(air_cleaning_4, 
                                    "1"="Other")) %>%
  mutate(air_cleaning_3=recode_factor(air_cleaning_3,
                                      "1"="Hiring someone to clean indoor air"))%>%
  mutate(air_cleaning_4=recode_factor(air_cleaning_4,
                                      "1"="Other")) %>%
  mutate(education=recode_factor(education,
                                 "0"="Did not specify", 
                                 "1"="High School Graduate",
                                 "2"="GED or Equivalent",
                                 "3"="Some College",
                                 "4"="Associate's Degree",
                                 "5"="Bachelor's Degree",
                                 "6"="Master's Degree",
                                 "7"="Doctoral Degree")) %>%
  mutate(income=recode_factor(income,
                              "1"="Less than $20,000", 
                              "2"="$20,000 to $34,999",
                              "3"="$35,000 to $49,999",
                              "4"="$50,000 to $79,999",
                              "5"="$80,000 to $99,999",
                              "6"="$100,000 to $149,999",
                              "7"="$150,000 to $199,999",
                              "8"="$200,000 or more",
                              "9"="Prefer not to answer")) %>%
  filter(finished==1) %>% #only analyzing finished data, not in wave.two
  filter(mailingcity=="BOULDER"|mailingcity=="SUPERIOR"|mailingcity=="LOUISVILLE") %>% 
  mutate(full_address = paste0(.$mailingaddr1,", ",.$mailingcity,", ", .$mailingstate,", ",.$mailingzip)) %>% 
  mutate_geocode(full_address, output="latlona") 
```

#### Data for Exposure Assingments:

```{r}

```

### Map of perception of air quality in one’s neighborhood  - color from stacked plot colors 
#### Before the Fire
```{r}
geo_marshall_1=filter(geo_marshall,!is.na(air_quality_1)) %>% 
  st_as_sf(coords=c("lon","lat"), crs = 4326)
marshall.sp.aq1 = as(geo_marshall_1,"Spatial")
factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Strongly disagree","Somewhat disagree", "Neither agree nor disagree","Somewhat agree","Strongly agree"))

leaflet(marshall.sp.aq1) %>%
  addTiles() %>%
  addCircleMarkers(group=marshall.sp.aq1$air_quality_1, color = ~factpal(air_quality_1),
                   radius = 1,
                   opacity = 1,
                   lng = marshall.sp.aq1@coords[,1],
                   lat = marshall.sp.aq1@coords[,2])

ggplot(filter(geo_marshall_1,!is.na(air_quality_1))) +
  annotation_map_tile() +
  annotation_scale() +
  geom_sf(aes(color=as.factor(air_quality_1))) +
  scale_color_manual(values = c("Strongly disagree"="#d7191c",
                                "Somewhat disagree"="#fdae61",
                                "Neither agree nor disagree"="#ffffbf",
                                "Somewhat agree"= "#a6d96a",
                                "Strongly agree" = "#1a9641")) +
  labs(title="Marshall Fire Survey Results (NA's filtered out)", 
       subtitle=paste0("Wave One: Total Respondants Displayed: ",nrow(filter(geo_marshall_1,!is.na(air_quality_1)))),
       caption="Statement: Before the Marshall Fire, I was confident that the \n air in my neighborhood was safe to breath") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5)) +
  guides(colour=guide_legend(title=""))
```

#### After the Fire
```{r}
geo_marshall_2=filter(geo_marshall,!is.na(air_quality_2)) %>% 
  st_as_sf(coords=c("lon","lat"), crs = 4326)
marshall.sp.aq2 = as(geo_marshall_2,"Spatial")
factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Strongly disagree","Somewhat disagree", "Neither agree nor disagree","Somewhat agree","Strongly agree"))

leaflet(marshall.sp.aq2) %>%
  addTiles() %>%
  addCircleMarkers(group=marshall.sp.aq2$air_quality_2, color = ~factpal(air_quality_2),
                   radius = 1,
                   opacity = 1,
                   lng = marshall.sp.aq2@coords[,1],
                   lat = marshall.sp.aq2@coords[,2])

ggplot(filter(geo_marshall_2,!is.na(air_quality_2))) +
  annotation_map_tile() +
  annotation_scale() +
  geom_sf(aes(color=as.factor(air_quality_2))) +
  scale_color_manual(values = c("Strongly disagree"="#d7191c",
                                "Somewhat disagree"="#fdae61",
                                "Neither agree nor disagree"="#ffffbf",
                                "Somewhat agree"= "#a6d96a",
                                "Strongly agree" = "#1a9641")) +
  labs(title="Marshall Fire Survey Results (NA's filtered out)", 
       subtitle=paste0("Wave One: Total Respondants Displayed: ",nrow(filter(geo_marshall_2,!is.na(air_quality_2)))),
       caption="Statement: Currently, I am confident that the air in \n my neighborhood is safe to breath") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5)) +
  guides(colour=guide_legend(title=""))
```

```{r, eval=FALSE, echo=FALSE}
#impact_cat

# factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Complete loss", "Damaged, living there","Damaged, not living there","No damage, living there","No damage, not living there"))
# 
# leaflet(marshall.sp) %>% 
#   addTiles() %>% 
#   # addPolygons(color="red",
#   #             opacity=0.5) %>% 
#   addCircleMarkers(group=marshall.sp$impact_cat, color = ~factpal(impact_cat),
#                    radius = 1,
#                    opacity = 1,
#                    lng = marshall.sp@coords[,1],
#                    lat = marshall.sp@coords[,2])
# 
# ggplot(geo_marshall) + 
#   annotation_map_tile() +
#   annotation_scale() +
#   geom_sf(aes(color=impact_cat)) +
#   scale_color_manual(values = c("Complete loss" = "#d7191c", 
#                                 "Damaged, living there" = "#fdae61",
#                                 "Damaged, not living there" = "#ffffbf",
#                                 "No damage, living there" = "#a6d96a",
#                                 "No damage, not living there" = "#1a9641")) +
#   ggtitle("Marshall Fire Survey Results", subtitle=paste0("Total Respondants Displayed: ",nrow(geo_marshall))) + 
#   theme(plot.title = element_text(hjust=0.5),
#         plot.subtitle = element_text(hjust=0.5)) +
#   guides(colour=guide_legend(title="Impact Level"))
```


### Moran’s I of perception of air quality in one’s neighborhood 
```{r}
library(moranfast)
moranfast(marshall.sp.aq1$air_quality_1, marshall.sp.aq1@coords[,1],marshall.sp.aq1@coords[,2])
moranfast(marshall.sp.aq2$air_quality_2, marshall.sp.aq2@coords[,1],marshall.sp.aq2@coords[,2])
```

### Map of perception of air quality in one’s home - color from stacked plot colors 
#### Before the Fire
```{r}
geo_marshall_3=filter(geo_marshall,!is.na(air_quality_3)) %>% 
  st_as_sf(coords=c("lon","lat"), crs = 4326)
marshall.sp.aq3 = as(geo_marshall_3,"Spatial")
factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Strongly disagree","Somewhat disagree", "Neither agree nor disagree","Somewhat agree","Strongly agree"))

leaflet(marshall.sp.aq3) %>%
  addTiles() %>%
  addCircleMarkers(group=marshall.sp.aq3$air_quality_3, color = ~factpal(air_quality_3),
                   radius = 1,
                   opacity = 1,
                   lng = marshall.sp.aq3@coords[,1],
                   lat = marshall.sp.aq3@coords[,2])

ggplot(filter(geo_marshall_3,!is.na(air_quality_3))) +
  annotation_map_tile() +
  annotation_scale() +
  geom_sf(aes(color=as.factor(air_quality_3))) +
  scale_color_manual(values = c("Strongly disagree"="#d7191c",
                                "Somewhat disagree"="#fdae61",
                                "Neither agree nor disagree"="#ffffbf",
                                "Somewhat agree"= "#a6d96a",
                                "Strongly agree" = "#1a9641")) +
  labs(title="Marshall Fire Survey Results (NA's filtered out)", 
       subtitle=paste0("Wave One: Total Respondants Displayed: ",nrow(filter(geo_marshall_3,!is.na(air_quality_3)))),
       caption="Statement: Currently, I am confident that the air in \n my neighborhood is safe to breath") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5)) +
  guides(colour=guide_legend(title=""))
```

#### After the Fire
```{r}
geo_marshall_4=filter(geo_marshall,!is.na(air_quality_4)) %>% 
  st_as_sf(coords=c("lon","lat"), crs = 4326)
marshall.sp.aq4 = as(geo_marshall_4,"Spatial")
factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Strongly disagree","Somewhat disagree", "Neither agree nor disagree","Somewhat agree","Strongly agree"))

leaflet(marshall.sp.aq4) %>%
  addTiles() %>%
  addCircleMarkers(group=marshall.sp.aq3$air_quality_4, color = ~factpal(air_quality_4),
                   radius = 1,
                   opacity = 1,
                   lng = marshall.sp.aq4@coords[,1],
                   lat = marshall.sp.aq4@coords[,2])

ggplot(filter(geo_marshall_4,!is.na(air_quality_4))) +
  annotation_map_tile() +
  annotation_scale() +
  geom_sf(aes(color=as.factor(air_quality_4))) +
  scale_color_manual(values = c("Strongly disagree"="#d7191c",
                                "Somewhat disagree"="#fdae61",
                                "Neither agree nor disagree"="#ffffbf",
                                "Somewhat agree"= "#a6d96a",
                                "Strongly agree" = "#1a9641")) +
  labs(title="Marshall Fire Survey Results (NA's filtered out)", 
       subtitle=paste0("Wave One: Total Respondants Displayed: ",nrow(filter(geo_marshall_4,!is.na(air_quality_4)))),
       caption="Statement: Currently, I am confident that the air in \n my neighborhood is safe to breath") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5)) +
  guides(colour=guide_legend(title=""))
```

### Moran’s I of perception of air quality in one’s home
```{r}
moranfast(marshall.sp.aq3$air_quality_3, marshall.sp.aq3@coords[,1],marshall.sp.aq3@coords[,2])
moranfast(marshall.sp.aq4$air_quality_4, marshall.sp.aq4@coords[,1],marshall.sp.aq4@coords[,2])
```



### Map of Wave One symptoms – do a separate map for each type of symptom with a color for yes and a different color for no on that symptom 

```{r}

```


### Map of Wave Two symptoms – do a separate map for each type of symptom with a color for yes and a different color for no on that symptom 

```{r}

```


#### After the Fire
```{r}
geo_marshall_4=filter(geo_marshall,!is.na(air_quality_4)) %>% 
  st_as_sf(coords=c("lon","lat"), crs = 4326)
marshall.sp.aq4 = as(geo_marshall_4,"Spatial")
factpal <- colorFactor(c("#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"), c("Strongly disagree","Somewhat disagree", "Neither agree nor disagree","Somewhat agree","Strongly agree"))

leaflet(marshall.sp.aq4) %>%
  addTiles() %>%
  addCircleMarkers(group=marshall.sp.aq4$air_quality_4, color = ~factpal(air_quality_4),
                   radius = 1,
                   opacity = 1,
                   lng = marshall.sp.aq4@coords[,1],
                   lat = marshall.sp.aq4@coords[,2])

ggplot(filter(geo_marshall_4,!is.na(air_quality_3))) +
  annotation_map_tile() +
  annotation_scale() +
  geom_sf(aes(color=as.factor(air_quality_3))) +
  scale_color_manual(values = c("Strongly disagree"="#d7191c",
                                "Somewhat disagree"="#fdae61",
                                "Neither agree nor disagree"="#ffffbf",
                                "Somewhat agree"= "#a6d96a",
                                "Strongly agree" = "#1a9641")) +
  labs(title="Marshall Fire Survey Results (NA's filtered out)", 
       subtitle=paste0("Wave One: Total Respondants Displayed: ",nrow(filter(geo_marshall_4,!is.na(air_quality_4)))),
       caption="Statement: Currently, I am confident that the air in \n my neighborhood is safe to breath") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5)) +
  guides(colour=guide_legend(title=""))
```


# Physical Health Symptoms

## Wave One:

### Wave One counts of symptoms bar plot or pie chart 

```{r}
wave1.symptoms=grep("^symptoms_\\d", names(wave.one), value=T)
rnames=c("Dry Cough","Wet Cough","Wheeze","Itchy or watery eyes",
         "Sore Throat","Headache","Shortness of Breath",
         "Difficult or labored breathing","Sneezing or stuffy nose",
         "Nausea or vomiting ","Allergic skin reaction",
         "Strange taste in your mouth","None of these")
count=list()
for(i in wave1.symptoms) {
  v=sum(!is.na(wave.one[,i]))
  count=c(count,v)
}
df_sym=cbind(wave1.symptoms,count,rnames) %>% 
  as.data.frame() %>% 
  dplyr::select(rnames,count)
df_sym$count=as.integer(df_sym$count)
colnames(df_sym)=c("Symptom","Count")
knitr::kable(df_sym)
# final_df = df %>% 
#   mutate(Percent=round(Count/nrow(wave.one)*100,2))
b=barplot(df_sym$Count, names.arg=df_sym$Symptom, las=2,
          main="Count of Symptoms")
text(b, df_sym$Count-10, df_sym$Count, font=2)
```

### Wave One table of symptom counts by distance category 

```{r}
count.dist=v=wave.one %>% 
  filter(!is.na(.[,wave1.symptoms[1]])) %>% 
  group_by(group) %>%
  count(.[,wave1.symptoms[1]]) %>% 
  as.data.frame() %>% 
  mutate(symptom=rnames[1]) %>% 
  dplyr::select(group,symptom,n)
for(i in 2:length(wave1.symptoms)) {
  v=wave.one %>% 
    filter(!is.na(.[,wave1.symptoms[i]])) %>% 
    group_by(group) %>%
    count(.[,wave1.symptoms[i]]) %>% 
    as.data.frame() %>% 
    mutate(symptom=rnames[i]) %>% 
    dplyr::select(group,symptom,n)
  count.dist=rbind(count.dist,v)
}
colnames(count.dist)=c("Distance","Symptom", "Count")
ggplot(data=count.dist, aes(x=Symptom,y=Count,fill=Distance)) +
  geom_bar(stat="identity") + 
  labs(title="Symptoms")
ggplot(data=count.dist, aes(x=Distance,y=Count,fill=Symptom)) +
  geom_bar(stat="identity") + 
  labs(title="Symptoms")
```

### Wave One table of symptom counts by impact category 

```{r}
count.impact= filter(wave.one,impact_cat!="") %>% 
  filter(!is.na(.[,wave1.symptoms[1]])) %>% 
  group_by(impact_cat) %>%
  count(.[,wave1.symptoms[1]]) %>% 
  as.data.frame() %>% 
  mutate(symptom=rnames[1]) %>% 
  dplyr::select(impact_cat,symptom,n)
for(i in 2:length(wave1.symptoms)) {
  v=filter(wave.one,impact_cat!="") %>% 
    filter(!is.na(.[,wave1.symptoms[i]])) %>% 
    group_by(impact_cat) %>%
    count(.[,wave1.symptoms[i]]) %>% 
    as.data.frame() %>% 
    mutate(symptom=rnames[i]) %>% 
    dplyr::select(impact_cat,symptom,n)
  count.impact=rbind(count.impact,v)
}
colnames(count.impact)=c("Impact_Category","Symptom", "Count")
ggplot(data=count.impact, aes(x=Symptom,y=Count,fill=Impact_Category)) +
  geom_bar(stat="identity") + 
  labs(title="Symptoms - Impact Category",
       subtitle = "I can change the colors of these graphs")
```

## Wave Two:

### Wave Two counts of symptoms bar plot or pie chart 

```{r}
wave2.symptoms=grep("^symptoms_\\d", names(wave.two), value=T)[-13:-14] # has 2 more columns
count2=list()
for(i in wave2.symptoms) {
  v=sum(wave.two[,i]==1, na.rm=T)
  count2=c(count2,v)
}

df_sym2=cbind(wave2.symptoms,count2,rnames) %>% 
  as.data.frame() %>% 
  dplyr::select(rnames,count2)
df_sym2$count2=as.integer(df_sym2$count2)
colnames(df_sym2)=c("Symptom","Count")
knitr::kable(df_sym2)
# final_df = df %>% 
#   mutate(Percent=round(Count/nrow(wave.one)*100,2))
b=barplot(df_sym2$Count, names.arg=df_sym2$Symptom, las=2,
          main="Count of Symptoms")
text(b, df_sym2$Count+15, df_sym2$Count, font=2)
```

### Wave Two table of symptom counts by distance category 

```{r}
count2.dist=v=wave.two %>% 
  filter(!is.na(.[,wave2.symptoms[1]])) %>% 
  group_by(group) %>%
  count(.[,wave2.symptoms[1]]) %>% 
  as.data.frame() %>% 
  mutate(symptom=rnames[1]) %>% 
  dplyr::select(group,symptom,n)
for(i in 2:length(wave1.symptoms)) {
  v=wave.two %>% 
    filter(!is.na(.[,wave2.symptoms[i]])) %>% 
    group_by(group) %>%
    count(.[,wave2.symptoms[i]]) %>% 
    as.data.frame() %>% 
    mutate(symptom=rnames[i]) %>% 
    dplyr::select(group,symptom,n)
  count2.dist=rbind(count2.dist,v)
}
colnames(count2.dist)=c("Distance","Symptom", "Count")
ggplot(data=count.dist, aes(x=Symptom,y=Count,fill=Distance)) +
  geom_bar(stat="identity") + 
  labs(title="Wave 2 Symptoms")
ggplot(data=count2.dist, aes(x=Distance,y=Count,fill=Symptom)) +
  geom_bar(stat="identity") + 
  labs(title="Wave 2 Symptoms")
```

### Wave Two table of symptom counts by impact category 

```{r}
count2.impact= filter(wave.two,impact_cat!="") %>% 
  filter(!is.na(.[,wave2.symptoms[1]])) %>% 
  filter(.[,wave2.symptoms[1]]==1) %>% 
  group_by(impact_cat) %>%
  count(.[,wave2.symptoms[1]]) %>% 
  as.data.frame() %>% 
  mutate(symptom=rnames[1]) %>% 
  dplyr::select(impact_cat,symptom,n)

for(i in 2:length(wave2.symptoms)) {
  v=filter(wave.two,impact_cat!="") %>% 
      filter(!is.na(.[,wave2.symptoms[i]])) %>% 
      filter(.[,wave2.symptoms[i]]==1) %>% 
      group_by(impact_cat) %>%
      count(.[,wave2.symptoms[i]]) %>% 
      as.data.frame() %>% 
      mutate(symptom=rnames[i]) %>% 
      dplyr::select(impact_cat,symptom,n)
  count2.impact=rbind(count2.impact,v)
}
colnames(count2.impact)=c("Impact_Category","Symptom", "Count")
ggplot(data=count2.impact, aes(x=Symptom,y=Count,fill=Impact_Category)) +
  geom_bar(stat="identity") + 
  labs(title="Symptoms - Impact Category",
       subtitle = "I can change the colors of these graphs")
```


## Wave One to Wave Two comparison – physical symptoms (maybe select to only be the people who responded to both waves) 

```{r}
compare = left_join(df_sym,df_sym2, by="Symptom")
colnames(compare)=c("Symptom","Wave_One","Wave_Two")
df = melt(compare, id=c("Symptom")) %>% 
  dplyr::mutate(Symptom=rep(1:13,2), 
         Symptom=recode_factor(Symptom,
                               "1"=rnames[1],
                               "2"=rnames[2],
                               "3"=rnames[3],
                               "4"=rnames[4],
                               "5"=rnames[5],
                               "6"=rnames[6],
                               "7"=rnames[7],
                               "8"=rnames[8],
                               "9"=rnames[9],
                               "10"=rnames[10],
                               "11"=rnames[11],
                               "12"=rnames[12],
                               "13"=rnames[13]))
ggplot(df) +
  geom_bar(aes(x = Symptom, y = value, fill = variable), 
           stat="identity", position = "dodge", width = 0.7) +
  scale_fill_manual("",
                    values = c("red","blue"), 
                    labels = c(" Wave One", " Wave Two")) +
  labs(title="Wave One / Wave Two Comparison",
       subtitle="Add counts to top of bars",
       x="Symptom",
       y="Count") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Comparing Respondants that replied to both surveys
```{r}
rnames=c("Dry Cough","Wet Cough","Wheeze","Itchy or watery eyes",
         "Sore Throat","Headache","Shortness of Breath",
         "Difficult or labored breathing","Sneezing or stuffy nose",
         "Nausea or vomiting ","Allergic skin reaction",
         "Strange taste in your mouth","None of these")
count3=list()
for(i in wave1.symptoms) {
  v=sum(!is.na(wave.one.only2[,i]))
  count3=c(count3,v)
}
count4=list()
for(i in wave2.symptoms) {
  v=sum(wave.two.only1[,i]==1, na.rm = T)
  count4=c(count4,v)
}
df_sym3=cbind(wave1.symptoms,count3,rnames) %>% 
  as.data.frame() %>% 
  dplyr::select(rnames,count3)
df_sym3$count3=as.integer(df_sym3$count3)
colnames(df_sym3)=c("Symptom","Count")
df_sym4=cbind(wave2.symptoms,count4,rnames) %>% 
  as.data.frame() %>% 
  dplyr::select(rnames,count4)
df_sym4$count4=as.integer(df_sym4$count4)
colnames(df_sym4)=c("Symptom","Count")
# final_df = df %>% 
#   mutate(Percent=round(Count/nrow(wave.one)*100,2))
compare = left_join(df_sym3,df_sym4, by="Symptom")
colnames(compare)=c("Symptom","Wave_One","Wave_Two")
df = melt(compare, id=c("Symptom")) %>% 
  dplyr::mutate(Symptom=rep(1:13,2), 
         Symptom=recode_factor(Symptom,
                               "1"=rnames[1],
                               "2"=rnames[2],
                               "3"=rnames[3],
                               "4"=rnames[4],
                               "5"=rnames[5],
                               "6"=rnames[6],
                               "7"=rnames[7],
                               "8"=rnames[8],
                               "9"=rnames[9],
                               "10"=rnames[10],
                               "11"=rnames[11],
                               "12"=rnames[12],
                               "13"=rnames[13]))
ggplot(df) +
  geom_bar(aes(x = Symptom, y = value, fill = variable), 
           stat="identity", position = "dodge", width = 0.7) +
  scale_fill_manual("",
                    values = c("red","blue"), 
                    labels = c(" Wave One", " Wave Two")) +
  labs(title="Wave One / Wave Two Comparison: \n Only Respondants in Both Waves",
       subtitle="Add counts to top of bars",
       x="Symptom",
       y="Count") +
  theme(plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))
```


### Predictors of Physical Health Symptoms 

```{r}
# Linear Regression
# Chi Squared
# G Squared
# ANOVA
# Generalized Additive Models (GAMs)
```

Discussion: FOR LATER 